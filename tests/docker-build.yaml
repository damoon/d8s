apiVersion: batch/v1
kind: Job
metadata:
  name: test-docker-build
spec:
  backoffLimit: 1
  template:
    metadata:
      name: test-docker-build
    spec:
      containers:
        - name: test
          image: testing-image
          command:
            - bash
            - -c
            - |
              set -euxo pipefail

              docker build ./docker
              if docker build missing; then echo "this should fail"; false; else echo "exit code propagated"; fi

              echo "done"
          env:
            - name: "DOCKER_HOST"
              value: "tcp://wedding:2376"
      restartPolicy: Never
